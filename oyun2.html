<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MSZ GiriÅŸim SimÃ¼latÃ¶rÃ¼</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #f0f0f0;
      padding: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    h1 {
      color: #00ff99;
      width: 100%;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      background-color: #00ff99;
      border: none;
      border-radius: 5px;
      color: #111;
      font-weight: bold;
      cursor: pointer;
    }
    #log {
      margin-top: 20px;
      background-color: #222;
      padding: 10px;
      border-radius: 5px;
      max-height: 200px;
      overflow-y: auto;
      width: 100%;
    }
    .section {
      background-color: #222;
      padding: 10px;
      border-radius: 5px;
      flex-grow: 1;
      min-width: 300px;
      max-width: 600px;
    }
    .market-item {
      background-color: #333;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    .menu-buttons button {
      margin-right: 10px;
    }
    #portfolio {
      background-color: #222;
      padding: 10px;
      border-radius: 5px;
      flex-grow: 1;
      min-width: 300px;
      max-width: 400px;
      height: fit-content;
      overflow-y: auto;
    }
    .owned-item {
      background-color: #444;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 5px;
    }
    input.price-input {
      width: 100px;
      padding: 5px;
      margin-top: 5px;
      border-radius: 3px;
      border: none;
      font-weight: bold;
    }
    input.rent-input {
      width: 100px;
      padding: 5px;
      margin-top: 5px;
      margin-left: 10px;
      border-radius: 3px;
      border: none;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ˆ MSZ GiriÅŸim SimÃ¼latÃ¶rÃ¼</h1>

  <div class="section" style="flex-basis: 100%;">
    <p><strong>Bakiye:</strong> <span id="money">5000</span> TL</p>
    <p><strong>Zaman:</strong> <span id="time">1 / 1</span></p>
    <p><strong>Kalan Ä°ÅŸlem:</strong> <span id="actions">5</span></p>
    <button onclick="nextMonth()">â­ï¸ AyÄ± GeÃ§</button>

    <div class="menu-buttons" style="margin-top:10px;">
      <button onclick="openMenu('car')">ğŸš— Araba</button>
      <button onclick="openMenu('phone')">ğŸ“± Telefon</button>
      <button onclick="openMenu('house')">ğŸ  Ev</button>
      <button onclick="work()">ğŸ’¼ Ä°ÅŸte Ã‡alÄ±ÅŸ (+5000 TL)</button>
    </div>
  </div>

  <div class="section" id="marketSection" style="flex-grow:2;">
    <!-- Dinamik iÃ§erik buraya gelecek -->
  </div>

  <div id="portfolio" class="section">
    <h3>ğŸ’¼ VarlÄ±klarÄ±n</h3>
    <div id="ownedItems"></div>
  </div>

  <div id="log"></div>

  <script>
    let money = 5000;
    let month = 1;
    let year = 1;
    let actions = 6;

    let cars = [];
    let phones = [];
    let houses = [];

    let carMarket = [
      { id: 1, model: "2008 Renault Clio", price: 600000, condition: "HasarsÄ±z" },
      { id: 2, model: "2012 Ford Focus", price: 300000, condition: "HasarlÄ±" }
    ];
    let phoneMarket = [
      { id: 1, model: "iPhone 12", price: 30000, condition: "HasarsÄ±z" },
      { id: 2, model: "Samsung S20", price: 15000, condition: "HasarlÄ±" }
    ];
    let houseMarket = [
      { id: 1, model: "2+1 Daire - Åehir Merkezi", price: 1500000, condition: "HasarsÄ±z" },
      { id: 2, model: "3+1 Daire - BanliyÃ¶", price: 750000, condition: "HasarlÄ±" }
    ];

    let currentMenu = "";

    function updateDisplay() {
      document.getElementById("money").innerText = money.toLocaleString();
      document.getElementById("time").innerText = `${month} / ${year}`;
      document.getElementById("actions").innerText = actions;
    }

    function log(text) {
      const logDiv = document.getElementById("log");
      logDiv.innerHTML += `<p>${text}</p>`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function useAction() {
      if (actions <= 0) {
        log("Bu ay daha fazla iÅŸlem yapamazsÄ±n.");
        return false;
      }
      actions--;
      updateDisplay();
      return true;
    }

    function nextMonth() {
      month++;
      if (month > 12) {
        month = 1;
        year++;
      }
      actions = 6;

      // AylÄ±k giderler
      let gider = 10000;
      if (money >= 100000) {
        gider = 40000;
      }
      money -= gider;
      log(`ğŸ’¸ AylÄ±k gider: ${gider.toLocaleString()} TL Ã¶dendi.`);

      // Her 5 ayda bir araba veya telefon fiyatlarÄ±nda %50 indirim
      const totalMonths = (year - 1) * 12 + month;
      if (totalMonths % 5 === 0) {
        const dropType = Math.random() < 0.5 ? 'car' : 'phone';
        if (dropType === 'car') {
          carMarket.forEach(item => {
            item.oldPrice = item.price;
            item.price = Math.floor(item.price * 0.5);
          });
          log(`âš ï¸ Araba fiyatlarÄ± bu ay %50 dÃ¼ÅŸtÃ¼!`);
        } else {
          phoneMarket.forEach(item => {
            item.oldPrice = item.price;
            item.price = Math.floor(item.price * 0.5);
          });
          log(`âš ï¸ Telefon fiyatlarÄ± bu ay %50 dÃ¼ÅŸtÃ¼!`);
        }
      } else if ((totalMonths - 1) % 5 === 0) {
        carMarket.forEach(item => {
          if (item.oldPrice) {
            item.price = item.oldPrice;
            delete item.oldPrice;
          }
        });
        phoneMarket.forEach(item => {
          if (item.oldPrice) {
            item.price = item.oldPrice;
            delete item.oldPrice;
          }
        });
        log(`âš ï¸ Fiyatlar eski seviyesine dÃ¶ndÃ¼.`);
      }

      // Zam ve dalgalanma
      applyPriceIncreaseWithFluctuation(carMarket, 0.10, 150000);
      applyPriceIncreaseWithFluctuation(phoneMarket, 0.10, 3000);
      applyPriceIncreaseWithFluctuation(houseMarket, 0.10, 150000);

      log(`ğŸ“† Yeni ay: ${month}/${year}`);
      renderMarket();
      renderOwned();
      updateDisplay();
    }

    function applyPriceIncreaseWithFluctuation(market, baseIncreasePercent, maxChange) {
      market.forEach(item => {
        // Temel %10 zam
        let newPrice = Math.floor(item.price * (1 + baseIncreasePercent));

        // Dalgalanma: +/- maxChange TL arasÄ± rastgele
        const fluctuation = Math.floor(Math.random() * (maxChange * 2 + 1)) - maxChange;

        // Yeni fiyat = zamlÄ± fiyat + dalgalanma
        newPrice = Math.max(5000, newPrice + fluctuation);

        item.price = newPrice;
      });
    }

    function work() {
      if (!useAction()) return;
      money += 5000;
      log("ğŸ’¼ Ä°ÅŸte Ã§alÄ±ÅŸarak 5000 TL kazandÄ±n.");
      updateDisplay();
    }

    function openMenu(type) {
      currentMenu = type;
      renderMarket();
      renderOwned();
    }

    function renderMarket() {
      const container = document.getElementById("marketSection");
      container.innerHTML = "";
      let marketList = [];
      if (currentMenu === "car") marketList = carMarket;
      else if (currentMenu === "phone") marketList = phoneMarket;
      else if (currentMenu === "house") marketList = houseMarket;

      if (!currentMenu) {
        container.innerHTML = "<p>AlÄ±m satÄ±m yapmak iÃ§in yukarÄ±daki menÃ¼den seÃ§im yap.</p>";
        return;
      }

      marketList.forEach(item => {
        const div = document.createElement("div");
        div.className = "market-item";
        div.innerHTML = `
          <strong>${item.model}</strong><br>
          Durum: ${item.condition}<br>
          Fiyat: ${item.price.toLocaleString()} TL<br>
          <button onclick="buyItem(${item.id})">SatÄ±n Al</button>
        `;
        container.appendChild(div);
      });
    }

    function buyItem(id) {
      if (!useAction()) return;
      let marketList, ownedList, typeName;
      if (currentMenu === "car") {
        marketList = carMarket;
        ownedList = cars;
        typeName = "Araba";
      } else if (currentMenu === "phone") {
        marketList = phoneMarket;
        ownedList = phones;
        typeName = "Telefon";
      } else if (currentMenu === "house") {
        marketList = houseMarket;
        ownedList = houses;
        typeName = "Ev";
      } else {
        log("LÃ¼tfen Ã¶nce kategori seÃ§in.");
        return;
      }
      const item = marketList.find(i => i.id === id);
      if (money >= item.price) {
        money -= item.price;
        ownedList.push({...item, buyPrice: item.price, rentPrice: 0});
        log(`âœ… ${typeName} "${item.model}" ${item.price.toLocaleString()} TL'ye satÄ±n alÄ±ndÄ±.`);
        updateDisplay();
        renderOwned();
      } else {
        log("Yeterli paran yok.");
      }
    }

    function renderOwned() {
      const container = document.getElementById("ownedItems");
      container.innerHTML = "";

      function createOwnedItem(item, index, typeName, ownedList) {
        const maxPrice = Math.floor(item.buyPrice * 1.5);  // max satÄ±ÅŸ fiyatÄ± 1.5 katÄ± olarak gÃ¼ncellendi
        let rentInputHtml = "";
        let rentButtonHtml = "";

        if(typeName === "house"){
          rentInputHtml = `<label>Kira Belirle (TL): <input type="number" min="1" max="${maxPrice}" class="rent-input" id="${typeName}_${index}_rent" placeholder="Kira fiyatÄ±"></label>`;
          rentButtonHtml = `<button onclick="rentHouse(${index})">Kirala</button>`;
        }

        const div = document.createElement("div");
        div.className = "owned-item";
        div.innerHTML = `
          <strong>${item.model}</strong><br>
          AlÄ±ÅŸ FiyatÄ±: ${item.buyPrice.toLocaleString()} TL<br>
          Durum: ${item.condition}<br>
          ${item.rentPrice ? `Kira (Eski): ${item.rentPrice.toLocaleString()} TL<br>` : ""}
          ${rentInputHtml}<br>
          ${rentButtonHtml}<br>
          <label>SatÄ±ÅŸ FiyatÄ± Belirle (max ${maxPrice.toLocaleString()} TL): <input type="number" min="1" max="${maxPrice}" class="price-input" id="${typeName}_${index}_price" placeholder="SatÄ±ÅŸ fiyatÄ±"></label><br>
          <button onclick="sellItem('${typeName}', ${index})">Sat</button>
        `;
        container.appendChild(div);
      }

      cars.forEach((item, i) => createOwnedItem(item, i, "car", cars));
      phones.forEach((item, i) => createOwnedItem(item, i, "phone", phones));
      houses.forEach((item, i) => createOwnedItem(item, i, "house", houses));
    }

    function sellItem(type, index) {
      if (!useAction()) return;
      let ownedList;
      if (type === "car") ownedList = cars;
      else if (type === "phone") ownedList = phones;
      else if (type === "house") ownedList = houses;
      else {
        log("GeÃ§ersiz tÃ¼r.");
        return;
      }
      const item = ownedList[index];
      const inputId = `${type}_${index}_price`;
      const priceInput = document.getElementById(inputId);
      const sellPrice = Number(priceInput.value);
      const maxPrice = Math.floor(item.buyPrice * 1.5);
      if (!sellPrice || sellPrice <= 0) {
        log("LÃ¼tfen geÃ§erli bir satÄ±ÅŸ fiyatÄ± girin.");
        return;
      }
      if(sellPrice > maxPrice){
        log(`SatÄ±ÅŸ fiyatÄ± satÄ±n alma fiyatÄ±nÄ±n 1.5 katÄ±ndan fazla olamaz. Max: ${maxPrice.toLocaleString()} TL`);
        return;
      }
      money += sellPrice;
      log(`ğŸ”» ${item.model} ${sellPrice.toLocaleString()} TL'ye satÄ±ldÄ±.`);
      ownedList.splice(index, 1);
      updateDisplay();
      renderOwned();
    }

    function rentHouse(index) {
      if (!useAction()) return;
      const house = houses[index];
      const rentInputId = `house_${index}_rent`;
      const rentInput = document.getElementById(rentInputId);
      const rentPrice = Number(rentInput.value);
      const maxPrice = Math.floor(house.buyPrice * 1.5);
      if (!rentPrice || rentPrice <= 0) {
        log("LÃ¼tfen geÃ§erli bir kira fiyatÄ± girin.");
        return;
      }
      if(rentPrice > maxPrice){
        log(`Kira fiyatÄ± satÄ±n alma fiyatÄ±nÄ±n 1.5 katÄ±ndan fazla olamaz. Max: ${maxPrice.toLocaleString()} TL`);
        return;
      }
      money += rentPrice;
      log(`ğŸ  ${house.model} iÃ§in ${rentPrice.toLocaleString()} TL kira geliri aldÄ±n.`);
      updateDisplay();
    }

    // Ä°lk yÃ¼kleme
    updateDisplay();
    renderMarket();
    renderOwned();
  </script>
</body>
</html>
